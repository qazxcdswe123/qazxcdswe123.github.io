# å‰è¨€

[gdb](https://www.sourceware.org/gdb/) æƒ³å¿…å¤§å®¶éƒ½å¬è¯´è¿‡ï¼Œä½œä¸ºæœ€æœ‰åæ°”çš„è°ƒè¯•å™¨ä¹‹ä¸€ï¼Œå´ç”±äºå…¶åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œçš„ç‰¹ç‚¹å¯¼è‡´äº†å‘¨å›´ç”¨çš„äººå¹¶ä¸ç®—å¤šï¼ŒåŠ ä¹‹ç°ä»£ç¼–è¾‘å™¨ä¸­çš„è°ƒè¯•åŠŸèƒ½å·²ç»æˆä¸ºæ ‡é…ï¼Œåœ¨å¾ˆå¤šæ—¶å€™ç”¨è‡ªå¸¦çš„è°ƒè¯•å™¨å°±èƒ½å®Œæˆè°ƒè¯•äº†ã€‚

ä½†æˆ‘ä¾æ—§è®¤ä¸º gdb ååˆ†é‡è¦ï¼Œä¸€æ˜¯å› ä¸ºå¦‚æœæ˜¯å¤šæ–‡ä»¶ç¼–ç¨‹å°±ä¸èƒ½ç”¨ VSCode ä¸­è‡ªå¸¦çš„è°ƒè¯•å™¨ï¼ˆå…¶å®ä¹Ÿæ˜¯ gdb ï¼Œå¥—äº†å±‚ gui ï¼Œæˆ–è®¸æ”¹ä¸‹ json èƒ½ç”¨ï¼Œä½†æ˜¯ä¸æ‰“ç®—æ”¹ï¼‰ï¼ŒäºŒæ˜¯å› ä¸ºå¸‚é¢ä¸Šä¸åŒç¼–è¾‘å™¨æ‰€å¸¦çš„è°ƒè¯•åŠŸèƒ½ç”¨æ³•è™½ç„¶å¤§åŒï¼Œä½†æ€»æ˜¯å°å¼‚ã€‚ç‰¹åˆ«æ˜¯ SCNU æœºæˆ¿çš„ç”µè„‘é»˜è®¤ VSCode é…ç½®æ— æ³•ç›´æ¥è°ƒè¯•ï¼Œä½†é»˜è®¤è£…æœ‰ gdbï¼ˆç¥å¥‡ï¼‰ ï¼Œå°±ä¸ç”¨åœ¨æœŸæœ«è€ƒè¯•æ—¶å€™æ¢ç”¨ä¸ç†Ÿæ‚‰çš„ VS || DevC++ äº† ï¼šï¼‰

# æ­£æ–‡

## å‰æœŸå‡†å¤‡

- gdb åœ¨å¯åŠ¨æ—¶ä¼šé¦–å…ˆå¼¹ä¸€ä¸ªç‰ˆæƒä¿¡æ¯ï¼Œå¾ˆçƒ¦ï¼Œå»ºè®®åœ¨ `~/.zshrc` || `~/.bashrc` ä¸­æ·»åŠ  `alias`
    `alias gdb="gdb -q"` æˆ–è€…å¯åŠ¨æ—¶æ·»åŠ  `-q` é€‰é¡¹ `q for quiet`
    
- gdb åœ¨é€€å‡ºæ—¶ä¼šå¼¹ä¸€ä¸ªç¡®è®¤ä¿¡æ¯ï¼Œå¦‚æœä½ è§‰å¾—çƒ¦ï¼Œä¹Ÿå¯ä»¥æ–°å»ºæ–‡ä»¶ `~/.gdbinit` å¹¶æ·»åŠ 
    `set confirm off`
    é¡ºå¸¦ä¸€æï¼Œ`~/.gdbinit` æ–‡ä»¶å¦‚å…¶åï¼Œæ˜¯gdbåœ¨å¯åŠ¨æ—¶ä¼šè¿è¡Œçš„å‘½ä»¤ï¼Œå€Ÿæ­¤èƒ½å¤Ÿå®ç°å¯¹ gdb çš„æ‰©å±•ï¼Œå¦‚ [pwndbg](https://github.com/pwndbg/pwndbg)
    
- **ç¼–è¯‘æ—¶éœ€è¦æ·»åŠ ç‰¹æ®Šå‚æ•° `-g` ä»£è¡¨è¿™ä¸ªç¨‹åºç¼–è¯‘æ—¶è¦ç•™ä¸‹è°ƒè¯•ä¿¡æ¯**
    ä¾‹å¦‚ï¼š`g++ main.cpp -o main -Wall -g`
    P.S. ä¼¼ä¹ä½¿ç”¨äº† `-O3` ç¼–è¯‘å‚æ•°ä¼šå¯¹ gdb äº§ç”Ÿå½±å“ï¼Ÿ
    > TheÂ [gcc docs](http://gcc.gnu.org/onlinedocs/libstdc++/manual/debug.html)Â note that the default debug flags areÂ `g`Â andÂ `O2`, and usingÂ `g -O0 -fno-inline`Â disables any optimization and function inlining.
    è¿™ç§æƒ…å†µä½¿ç”¨ `-Og` å‚æ•°æ¥é¿å…å½±å“ï¼ˆæˆ–è€…å¹²è„† `-O0` ï¼‰

## è°ƒè¯•çš„ç†å¿µ

ğŸ’¡ è¿™éƒ¨åˆ†æ˜¯æˆ‘è‡ªå·±çš„ç†è§£ï¼Œè°ƒè¯•ç”¨çš„è¿˜å°‘ï¼Œå­¦çš„å¾ˆæµ…ï¼Œå¸Œæœ›æœ‰äººè¡¥å……

å…ˆç¨å¾®è®²ä¸‹æˆ‘å¯¹è°ƒè¯•çš„ç†è§£

ä¸€æ•´ä¸ªè½¯ä»¶ | ä»£ç æ˜¯ååˆ†åºå¤§çš„ï¼Œäººè„‘å¤„ç†ä¸è¿‡æ¥ï¼Œæ›´åˆ«è¯´å„ç±»å¾ªç¯åµŒå¥—ä¸ªä¸‰å››å±‚ï¼ˆmy shitty code would be likeï¼‰ä¹‹ååŸºæœ¬ä¸Šå°±å¾ˆéš¾åˆ¤æ–­ä¸­é—´è¿‡ç¨‹å®ç°çš„å¯¹é”™äº†ã€‚

è€Œæœ€åŸºæœ¬çš„è°ƒè¯•å°±æ˜¯æŠŠå¤§å—çš„ä»£ç åˆ†å¼€ï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æš‚åœï¼Œèƒ½å¤Ÿçœ‹åˆ°ä¸­é—´å˜é‡å€¼æ¥åˆ¤æ–­å®ç°çš„å¯¹é”™ï¼ˆbreakpoint | printï¼‰

æ›´è¿›ä¸€æ­¥çš„è°ƒè¯•åˆ™æ˜¯åº•å±‚æ–¹é¢çš„è°ƒè¯•ï¼ˆæ ˆï¼Œ[æ ˆå¸§](https://stackoverflow.com/questions/10057443/explain-the-concept-of-a-stack-frame-in-a-nutshell)ï¼Œå†…å­˜åœ°å€ï¼Œcall stackï¼Œæ±‡ç¼–ï¼Œå¯„å­˜å™¨ etc.ï¼‰ç­‰ä¸é‚£ä¹ˆæ˜¾è€Œæ˜“è§çš„è°ƒè¯•

æœ¬æ–‡åªæ¶‰åŠæœ€åŸºæœ¬è°ƒè¯•

ğŸ’¡ åœ¨ä¸‹é¢æ“ä½œå‰ï¼Œå…ˆ `gdb program_name` è¿›å…¥ gdb ç•Œé¢


## æ–­ç‚¹

### ç”Ÿæˆæ–­ç‚¹

ä»ä¸Šé¢çš„ç†è§£æ¥çœ‹ï¼Œè°ƒè¯•è‡³å°‘è¦æœ‰è¿è¡Œè¿‡ç¨‹ä¸­æš‚åœçš„åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å°±æ˜¯ `breakpoint` aka æ–­ç‚¹

ç”¨æ³•1ï¼š `break $line_number` || `break 9` 

è¿™æ—¶å€™è™½ç„¶ä½ çœ‹ä¸è§ï¼Œä½†æ˜¯ gdb å·²ç»æ‰“å¥½æ–­ç‚¹äº† `Breakpoint 1 at 0x5d94: file main.cpp, line 10.` 

ä¸è¿‡æœ‰ä¸¤ç‚¹ç‚¹éœ€è¦æ³¨æ„ï¼Œç¬¬ä¸€ç‚¹å¦‚ä¸Šæ–‡ï¼Œè¾“å…¥çš„æ˜¯ç¬¬9è¡Œå¤„æ‰“æ–­ç‚¹ï¼Œå®é™…ä¸Šæ–­ç‚¹äº§ç”Ÿåœ¨ç¬¬10è¡Œï¼Œè¿™æ˜¯å› ä¸º gdb ä¼šè‡ªåŠ¨æ‰¾ç¬¬ä¸€ä¸ªæœ‰æ•ˆæ‰§è¡Œè¯­å¥è€Œå¿½ç•¥å…¶ä»–é¢„å¤„ç†è¯­å¥å¦‚ `include namespace define etc.` .ç¬¬äºŒç‚¹æ˜¯å¦‚æœåœ¨æƒ³åœ¨å¤šæ–‡ä»¶ç¼–ç¨‹æ—¶ç»™å…¶ä»–æ–‡ä»¶æ‰“æ–­ç‚¹ï¼Œéœ€è¦ä½¿ç”¨ `break file_name.c:60` 

ç”¨æ³•2ï¼š`break $function_nmae` || `break main`

ç›´æ¥æ‰¾åˆ°å‡½æ•°æ‰“æ–­ç‚¹ï¼Œé€‚åˆä¸çŸ¥é“åœ¨ç¬¬å‡ è¡Œä½†æ˜¯çŸ¥é“å‡½æ•°åçš„æ›´å¤šæ•°æƒ…å†µï¼Œåœ¨ä½¿ç”¨å‡½æ•°æ¨¡å—åŒ–åŠŸèƒ½ä»¥åŠåˆ†æ–‡ä»¶ç¼–ç¨‹æ—¶ååˆ†å¥½ç”¨ï¼

æ‰“æ–­ç‚¹ä»€ä¹ˆéƒ½å¥½ï¼Œå°±æœ‰ä¸€ç‚¹ï¼Œbreak è¿™ä¸ªå•è¯å¤ªé•¿äº†ï¼Œä½¿ç”¨é¢‘ç‡å¤ªé«˜äº†ï¼Œè™½ç„¶ **gdb æä¾›äº† tab è‡ªåŠ¨è¡¥å…¨**ï¼Œä½†è¿˜æ˜¯éº»çƒ¦ï¼Œæ‡’æ˜¯äººç±»ç¬¬ä¸€ç”Ÿäº§åŠ›ï¼Œgdb å†…ç½®äº†éƒ¨åˆ†ä½¿ç”¨é¢‘ç‡é«˜çš„åŠŸèƒ½çš„ç¼©å†™ã€‚ç®€å•æ¥è¯´ï¼Œå¯¹äº `break` å‘½ä»¤ç›´æ¥è¾“ `b` ä¹Ÿæ˜¯ç­‰ä»·çš„ 

ç”¨æ³•3ï¼š `b 9` || `b main`

æ‰“å®Œæ–­ç‚¹ä¹‹ååœ¨ gdb ä¸­ç›´æ¥è¾“å…¥ `run` å°±è¡Œäº†ï¼Œè¿™å°±èƒ½åœ¨æ–­ç‚¹å¤„æš‚åœæ‰§è¡Œäº†ï¼Œæƒ³è¦æ‰§è¡Œä¸‹ä¸€æ­¥éœ€è¦ä½¿ç”¨ `next` || `step` || `continue`ï¼Œå°†åœ¨ç¨åè¯¦ç»†å¯¹æ¯”

### åˆ é™¤æ–­ç‚¹

è¦æ˜¯æ–­ç‚¹ç»™é”™ï¼Œç”¨ `delete` å‘½ä»¤åˆ é™¤ï¼Œç¼©å†™ä¸º `d`

ç”¨æ³•ï¼š `delete $breakpoint_index` || `delete 2`

æ³¨æ„è¿™é‡Œçš„ 2 ä¸æ˜¯è¡Œå·ï¼Œè€Œæ˜¯**æ–­ç‚¹åºå·**ï¼Œå¦‚æœå¿˜è®°æ–­ç‚¹åºå·ï¼Œä½¿ç”¨ `info break` æŸ¥çœ‹ã€‚ç›¸ä¼¼çš„ï¼Œå¦‚æœæƒ³çœ‹è‡ªå·±æ‰“äº†å“ªäº›æ–­ç‚¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `info break` æ¥æŸ¥çœ‹ã€‚

### ä»£ç å¯¹ç…§

ä¸Šé¢æåˆ°æ‰“æ–­ç‚¹è¦çŸ¥é“è¡Œå·æˆ–è€…å‡½æ•°åï¼Œé‚£ä¸å¾—ç¼–è¾‘å™¨å’Œ gdb åˆ†å±çœ‹ï¼Ÿå¤ªéº»çƒ¦äº†ï¼æ‡’åˆæ˜¯äººç±»ç¬¬ä¸€ç”Ÿäº§åŠ›ï¼Œgdb å…¶å®è‡ªå¸¦äº†ä»£ç å’Œ gdb å‘½ä»¤è¡Œçš„å¯¹ç…§

ç”¨æ³•ï¼š`gdb -tui program_name` ï¼ˆåœ¨è¿è¡Œ gdb æ—¶æ·»åŠ å‚æ•°ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨ gdb ä¸­ `ctrl-x` è¿›å…¥ï¼Œ `ctrl-a` é€€å‡ºã€‚

![èƒ½å¤Ÿå±•ç¤ºæ–­ç‚¹ä½ç½®ï¼Œå½“å‰æ‰§è¡Œæƒ…å†µï¼Œä»¥åŠä»£ç çš„å¯¹ç…§](https://s2.loli.net/2021/12/30/kDN1KYVLzq3hXZP.png)

## è¿è¡Œç¨‹åº

åœ¨æ‰“å®Œæ–­ç‚¹åå°±èƒ½è¿è¡Œäº†ã€‚åœ¨ gdb ä¸­ç›´æ¥è¾“å…¥ `r` å°±è¡Œï¼ˆ`run` çš„ç¼©å†™ï¼‰ï¼Œè¿™å°±èƒ½åœ¨æ–­ç‚¹å¤„æš‚åœæ‰§è¡Œäº†ï¼Œæƒ³è¦æ‰§è¡Œä¸‹ä¸€æ­¥éœ€è¦ä½¿ç”¨ `next` || `step` || `continue`ï¼Œå°†åœ¨æ­¤è¯¦ç»†å¯¹æ¯”

### Step

è¿è¡Œä¸‹ä¸€æ­¥ä»£ç ï¼ŒåŒæ—¶é‡åˆ°è‡ªå·±å®šä¹‰çš„å‡½æ•°**å°†ä¼š**è¿½è¸ªè¿›å…¥å‡½æ•°ï¼Œè¿›ä¸€æ­¥debugã€‚ç¼©å†™ä¸º `s`

### Next

è¿è¡Œä¸‹ä¸€æ­¥ä»£ç ï¼Œä½†åœ¨é‡åˆ°è‡ªå·±å®šä¹‰çš„å‡½æ•°**ä¸ä¼š**è¿½è¸ªè¿›å…¥å‡½æ•°ï¼Œè€Œæ˜¯ç›´æ¥è·å–è¿”å›å€¼å¾€ä¸‹è¿è¡Œã€‚ç®€å•æ¥è¯´ï¼Œå…¨ç¨‹ `next` åªä¼šæ‰§è¡Œå®Œ `main` å‡½æ•°ï¼Œè€Œ `step` å°†ä¼šæ‰§è¡Œå®Œæ¯ä¸€è¡Œä»£ç ã€‚ç¼©å†™ä¸º `n`

### Continue

è¿è¡Œåˆ° breakpoint æˆ–è€…è¿è¡Œå®Œæ•´ä¸ªç¨‹åºã€‚ç¼©å†™ä¸º `c`

ğŸ’¡ å®é™…ä¸Šï¼Œä¸Šé¢çš„ä»‹ç»é¡ºåºæ˜¯æŒ‰è¿è¡Œå®Œç¨‹åºæ‰€éœ€æ“ä½œæ•°æ¥æ’åºçš„

### Until

until è¿è¡Œè‡³æŸè¡Œåœæ­¢ (until reach the line) ï¼Œä¸€èˆ¬ç”¨æ¥è·³å‡ºå¾ªç¯ï¼Œç¼©å†™ä¸º `u`

ç”¨æ³•ï¼š`u $line_number` || `u 60`

åŒæ—¶ï¼Œåœ¨ gdb ä¸‹ç›´æ¥å›è½¦çš„ä½œç”¨æ˜¯é‡å¤ä¸Šä¸€æŒ‡ä»¤ï¼Œå¯¹äºå•æ­¥è°ƒè¯•ï¼ˆä¹Ÿå°±æ˜¯`step` || `next` è¿™æ ·ä¸€æ­¥æ­¥è¿›è¡Œçš„è°ƒè¯•ï¼‰éå¸¸æ–¹ä¾¿

## å˜é‡å€¼æŸ¥çœ‹

æ‰“å®Œæ–­ç‚¹ï¼Œç”¨ `step` || `next` || `continue` æ‰§è¡Œä¸‹ä¸€æ­¥ï¼Œä¸ä¼šç»™ä½ ä»»ä½•æœ‰æ•ˆä¿¡æ¯ï¼Œä½ è¿˜éœ€è¦æ‰‹åŠ¨é€‰æ‹©å˜é‡å€¼è¿›è¡ŒæŸ¥çœ‹ã€‚æœ‰ä¸¤ç§æ–¹å¼ï¼Œ`print` || `watch`

### Print

å•æ¬¡æ‰“å°ä¸€ä¸ªå€¼ï¼Œä½†ä¸ä»…æ˜¯å˜é‡å€¼ï¼Œå¯ä»¥æ˜¯ä»»ä½• C è¯­è¨€çš„æœ‰æ•ˆè¡¨è¾¾å¼ï¼ŒåŒ…æ‹¬æ•°å­—ï¼Œå˜é‡ç”šè‡³æ˜¯å‡½æ•°è°ƒç”¨ã€‚ç¼©å†™ä¸º `p`

```
p aï¼šå°†æ˜¾ç¤ºæ•´æ•° a çš„å€¼
p ++aï¼šå°†æŠŠ a ä¸­çš„å€¼åŠ  1, å¹¶æ˜¾ç¤ºå‡ºæ¥
p nameï¼šå°†æ˜¾ç¤ºå­—ç¬¦ä¸² name çš„å€¼
p gdb_test(22)ï¼šå°†ä»¥æ•´æ•° 22 ä½œä¸ºå‚æ•°è°ƒç”¨ gdb_test() å‡½æ•°
p gdb_test(a)ï¼šå°†ä»¥å˜é‡ a ä½œä¸ºå‚æ•°è°ƒç”¨ gdb_test() å‡½æ•°
```

### Watch

ä½¿ç”¨ `watch` å‘½ä»¤è®¾ç½®è§‚å¯Ÿç‚¹ï¼Œä¹Ÿå°±æ˜¯å½“ä¸€ä¸ªå˜é‡å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç¨‹åºä¼šåœä¸‹æ¥ã€‚ç¼©å†™ä¸º `wa` 

ç”¨æ³•ï¼š`watch a` å½“ a å‘ç”Ÿæ”¹å˜æ—¶å°±ä¼šåœæ­¢

---

è‡³æ­¤ï¼ŒåŸºç¡€çš„ gdb è°ƒè¯•å°±ç®—ä»‹ç»å®Œäº†ï¼Œé€€å‡ºä½¿ç”¨ `quit` || `q` å³å¯

## åŠŸèƒ½è¡¥å……

### Info

ç”¨äºæŸ¥çœ‹å„ç§ä¿¡æ¯

```
info function // åˆ—å‡ºå¯æ‰§è¡Œæ–‡ä»¶çš„æ‰€æœ‰å‡½æ•°åç§°ï¼Œå¯ä»¥ç”¨æ¥æ‰“æ–­ç‚¹
info functions $regex // æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å‡½æ•°å
info breakpoints // åˆ—å‡ºæ–­ç‚¹
info locals // æ‰“å°å½“å‰å‡½æ•°å±€éƒ¨å˜é‡çš„å€¼
info args // æ‰“å°ä¼ å…¥å‡½æ•°çš„å‚æ•° arguments aka å®å‚
```

### Backtrace

ä¸€èˆ¬ç¨‹åºå´©æºƒæ—¶åªä¼šå‘Šè¯‰ä½  Segmentation Fault ï¼Œé€šè¿‡ backtrace å¯ä»¥çŸ¥é“æ—¶å“ªä¸€è¡Œå‡ºç°é”™è¯¯ï¼Œç¼©å†™ä¸º `bt`

![æ•…æ„å†™é”™å°è¯•ä¸‹å°±çŸ¥é“äº†](https://s2.loli.net/2021/12/30/pfoIDcVnFd7Cwms.png)

## å…¶ä»–è¡¥å……

`start` vs `run`

> `run`Â will start (or restart) the program from the beginning and continue execution until a breakpoint is hit or the program exits.Â `start`Â will start (or restart) the program and stop execution at the beginning of theÂ `main`Â function.
> 

`finish` 

> `continue`Â (shorthand:Â `c`) will resume execution until the next breakpoint is hit or the program exits.Â `finish`Â will run until the current function call completes and stop there. You can single-step through the C source using theÂ `next`Â (shorthand:Â `n`) orÂ `step`Â (shorthand:Â `s`) commands, both of which execute a line and stop. The difference between these two is that if the line to be executed is a function call,Â `next`Â executes theÂ *entire function*, butÂ `step`Â goes into the function implementation and stops at the first line.
> 

ç¼©å†™ä¸€è§ˆï¼Œä»ç¼©å†™åå­¦æˆ–è®¸æ˜¯ä¸ªä¸é”™çš„ä¸»æ„

> b -> break
c -> continue
d -> delete
f -> frame
i -> info
j -> jump
l -> list
n -> next
p -> print
r -> run
s -> step
u -> until
aw -> awatch
bt -> backtrace
dir -> directory
disas -> disassemble
fin -> finish
ig -> ignore
ni -> nexti
rw -> rwatch
si -> stepi
tb -> tbreak
wa -> watch
win -> winheight
> 

å½“æ•°å€¼åˆ° X æ—¶è®¾ç½®æ–­ç‚¹ï¼Œåœ¨æ–­ç‚¹è®¾ç½®ååŠ  `if`

> `break iter.c:6 if i == 5` || `break main:looping if i == 5`

[CS107 Software Testing Strategies](https://web.stanford.edu/class/archive/cs/cs107/cs107.1194/testing.html)

# å‚è€ƒèµ„æ–™

[1. gdb è°ƒè¯•åˆ©å™¨ - Linux Tools Quick Tutorial](https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/gdb.html)

[100ä¸ªgdbå°æŠ€å·§](https://wizardforcel.gitbooks.io/100-gdb-tips/content/)

[CS107 GDB and Debugging](https://web.stanford.edu/class/archive/cs/cs107/cs107.1194/resources/gdb)

[GDB: break if variable equal value](https://stackoverflow.com/questions/14390256/gdb-break-if-variable-equal-value)

æœ€åé¢„å‘Šä¸‹ï¼Œå¯’å‡æœŸé—´åº”è¯¥ä¼šå†™ Missing Semester ç›¸å…³çš„ç³»åˆ—æ–‡ç« ï¼Œè®¡åˆ’ä¸€å¤©ä¸€ç¯‡ï¼Œæš‚å®šå†…å®¹ä¸º
- Command Line 
- git
- regex
- vim
- docker
- Misc

çœ‹çœ‹èƒ½ä¸èƒ½æˆä¸ºå›½æ¸…å¸ˆå…„çš„å¯’å‡ Missing Semester è®¡åˆ’çš„è¡¥å……-ã€‚-
<!--stackedit_data:
eyJoaXN0b3J5IjpbNDYwMDg3MzcyXX0=
-->